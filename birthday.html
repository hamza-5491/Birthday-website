<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Birthday Wishes â€” Production Ready (Updated Cake & Balloons)</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  :root{
    --bg1:#0b1020; --bg2:#03040a;
    --accent1:#ff6b9a; --accent2:#ff5572;
  }
  html,body{height:100%}
  body{
    margin:0;
    background: radial-gradient(1200px 600px at 10% 10%, var(--bg1) 0%, #05060a 30%, var(--bg2) 100%);
    color:#e6eef8;
    font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    overflow-x:hidden;
    -webkit-tap-highlight-color: transparent;
  }

  /* ---------- Intro overlay (3 dots -> heart) ---------- */
  #overlay {
    position:fixed; inset:0; z-index:60;
    display:flex; align-items:center; justify-content:center;
    background: linear-gradient(180deg, rgba(0,0,0,0.58), rgba(0,0,0,0.72));
    pointer-events:none;
  }
  .intro-inner{ text-align:center; pointer-events:none; }
  .intro-dot{
    position:fixed; width:30px; height:30px; border-radius:999px;
    filter: drop-shadow(0 12px 30px rgba(0,0,0,0.6));
    z-index:62; opacity:1;
  }
  .heart-wrap{ width:160px; height:160px; display:flex; align-items:center; justify-content:center; }
  svg.heart{ width:130px; height:130px; opacity:0; transform:scale(.6) rotate(0deg); transition:opacity .45s ease, transform .6s cubic-bezier(.2,.9,.2,1); filter: drop-shadow(0 20px 50px rgba(255,77,109,.14)); }
  svg.heart.show{ opacity:1; transform:scale(1) rotate(-6deg); }
  .intro-text{ margin-top:14px; color:#e6f0ff; font-weight:700; opacity:0; transform:translateY(8px); transition:opacity .45s, transform .45s; }

  /* ---------- Countdown digits ---------- */
  .count-card{ backdrop-filter: blur(8px); background: linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.04); }
  .digit-wrap{ perspective:600px; display:inline-block; }
  .rotate-digit{ display:inline-block; transform-origin:center; backface-visibility:hidden; font-variant-numeric: tabular-nums; }
  .digit-anim{ animation: digitFlip .45s ease forwards; }
  @keyframes digitFlip { 0%{ transform: rotateX(-70deg) translateZ(0); opacity:0 } 50%{ transform: rotateX(20deg) translateZ(0); opacity:1 } 100%{ transform: rotateX(0deg) translateZ(0); opacity:1 } }

  /* ---------- Cake (upgraded realistic CSS 3-layer) ---------- */
  .cake-plate { width:480px; max-width:92%; margin:0 auto; position:relative; display:block; }
  .cake-wrapper { display:flex; justify-content:center; align-items:center; position:relative; }

  .cake {
    position: relative;
    width: 360px;
    margin: 0 auto;
    transform-origin: center;
    animation: cakeFloat 3500ms ease-in-out infinite;
  }
  @keyframes cakeFloat { 0%{ transform: translateY(0) } 50%{ transform: translateY(-6px) } 100%{ transform: translateY(0) } }

  /* Layers: bottom (largest) -> top (smallest) */
  .layer {
    border-radius: 22px;
    width: 100%;
    position: relative;
    box-shadow: 0 22px 70px rgba(2,6,23,0.65);
    overflow: visible;
    margin-top: -38px;
  }
  .layer.bottom { height: 120px; background: linear-gradient(180deg,#f3d6e2 0%, #ffdbe6 100%); }
  .layer.mid    { height: 92px;  background: linear-gradient(180deg,#fff0f6 0%, #ffdbe6 100%); transform: scale(0.92) translateY(-30px); }
  .layer.top    { height: 68px;  background: linear-gradient(180deg,#fffafc 0%, #ffebf2 100%); transform: scale(0.78) translateY(-58px); }

  /* icing / drips - top of each layer */
  .icing {
    position:absolute; left:0; right:0; height:28px; top:-18px;
    background: linear-gradient(180deg,#fff6fb,#ffeef8);
    border-radius: 14px;
    box-shadow: inset 0 6px 14px rgba(255,255,255,0.6);
    overflow:hidden;
  }
  .drip-blob { position:absolute; bottom: -6px; width:28px; height:28px; background: inherit; border-radius:50%; box-shadow: inset 0 3px 6px rgba(255,255,255,0.5); }
  /* place some drips */
  .drip-1{ left:8%; transform: scaleX(1.2) scaleY(1.0); }
  .drip-2{ left:28%; transform: scaleX(0.9) scaleY(1.1); }
  .drip-3{ left:52%; transform: scaleX(1.1) scaleY(0.95); }
  .drip-4{ left:74%; transform: scaleX(0.85) scaleY(1.08); }

  /* sprinkles */
  .sprinkle { position:absolute; width:10px; height:4px; border-radius:5px; box-shadow: 0 2px 6px rgba(0,0,0,0.12); transform-origin:center; }

  /* candle area */
  .candles {
    position:absolute; left:50%; transform:translateX(-50%); top:-112px; display:flex; gap:12px; align-items:flex-end; z-index:20;
  }
  .candle {
    width:10px; height:48px; border-radius:3px; position:relative; background: linear-gradient(180deg,#ffd27a,#ffc04d); box-shadow: 0 8px 22px rgba(0,0,0,0.38);
    display:flex; align-items:flex-start; justify-content:center;
  }
  .wick { position:absolute; top:-6px; left:50%; transform:translateX(-50%); width:2px; height:8px; background:#2b2b2b; border-radius:2px; }
  .flame {
    position:absolute; top:-18px; left:50%; transform:translateX(-50%); width:14px; height:20px;
    background: radial-gradient(circle at 50% 30%, #fff6b8 0%, #ffd27a 35%, #ff8b3b 75%);
    border-radius:50%;
    filter: drop-shadow(0 10px 20px rgba(255,150,60,0.12));
    animation: flicker 900ms linear infinite;
  }
  @keyframes flicker { 0%{ transform: translateX(-50%) translateY(0) scaleY(1) } 50%{ transform: translateX(-50%) translateY(-2px) scaleY(1.08) } 100%{ transform: translateX(-50%) translateY(0) scaleY(1) } }

  /* cake base shadow */
  .cake-shadow { width:72%; height:26px; background: radial-gradient(closest-side, rgba(2,6,23,0.55), transparent); margin:10px auto 0; border-radius:50%; filter: blur(14px); transform:translateY(-28px); }

  /* ---------- Balloons (realistic upgraded) ---------- */
  .balloon { position:absolute; bottom:-26%; width:60px; height:80px; border-radius:56% 56% 48% 48%; box-shadow: 0 18px 44px rgba(2,6,23,0.6); pointer-events:none; transform-origin:center; z-index:40; }
  .balloon .string { position:absolute; bottom:-74px; left:50%; width:2px; height:70px; transform:translateX(-50%); background: linear-gradient(180deg, rgba(0,0,0,0.18), rgba(255,255,255,0.02)); border-radius:1px; }
  .balloon .shine { position:absolute; top:12%; left:18%; width:30%; height:30%; background: radial-gradient(closest-side, rgba(255,255,255,0.7), rgba(255,255,255,0.12)); border-radius:50%; opacity:0.85; transform: rotate(-18deg); }
  @keyframes balloonRise { 0%{ transform: translateY(0) } 100%{ transform: translateY(-140vh) } }

  /* ---------- small cards ---------- */
  .small-card { width:320px; height:180px; border-radius:14px; box-shadow:0 20px 70px rgba(2,6,23,.6); transform-origin:center bottom; opacity:0; transform:translateY(40px) scale(.96); transition:transform .55s cubic-bezier(.2,.9,.2,1), opacity .45s, filter .4s; }
  .small-card.show { opacity:1; transform:translateY(-140px) scale(1); }
  .small-card.prev-blur { filter: blur(6px) saturate(.85) brightness(.85); opacity:.62; transform:translateY(-140px) scale(.98); }

  /* slider */
  #slider { border-radius:12px; overflow:hidden; box-shadow: 0 30px 80px rgba(2,6,23,.65); }
  .slide { min-width:100%; height:360px; background-size:cover; background-position:center; position:relative; transition: transform .9s cubic-bezier(.2,.9,.2,1), opacity .6s; }
  .slide::before{ content:''; position:absolute; inset:0; background:linear-gradient(180deg, rgba(2,6,23,0.22), rgba(0,0,0,0.6)); z-index:1; }
  .slide.fade-out{ opacity:0; transform:scale(.99); }

  @media (max-width:640px){
    .intro-dot{ width:20px; height:20px; }
    svg.heart{ width:110px; height:110px; }
    .small-card{ width:260px; height:150px; }
    .slide{ height:440px }
    .cake-plate{ max-width:95% }
    .cake-plate .candles{ top:-84px }
    .balloon{ width:44px; height:60px; }
  }
</style>
</head>
<body>

<!-- INTRO overlay -->
<div id="overlay">
  <div class="intro-inner">
    <div class="heart-wrap" id="heartWrap">
      <svg id="heartSvg" class="heart" viewBox="0 0 32 29" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <defs><linearGradient id="g1" x1="0" x2="1"><stop offset="0" stop-color="#ff9bb8"/><stop offset="1" stop-color="#ff5572"/></linearGradient></defs>
        <path d="M16 27s-8.6-5.8-13-9.6C-0.6 11.6 3 6 7.7 6c2.3 0 3.8 1 4.8 2.3 1-1.3 2.5-2.3 4.8-2.3 4.7 0 8.3 5.6 4.7 11.4-4.4 3.8-13 9.6-13 9.6z" fill="url(#g1)"/></svg>
    </div>
    <div id="overlayText" class="intro-text text-lg">preparing something special...</div>
  </div>
</div>

<main id="main" class="max-w-4xl mx-auto px-4 py-10 space-y-8">

  <!-- COUNTDOWN -->
  <section id="countdownSection" class="hidden rounded-2xl p-6">
    <h2 class="text-center text-3xl font-extrabold tracking-tight">Birthday countdown</h2>
    <p class="text-center text-sm text-gray-400 mt-1">The magical moment approaches...</p>
    <div class="mt-6 grid grid-cols-2 sm:grid-cols-4 gap-4">
      <div class="count-card p-4 rounded-xl text-center text-white">
        <div class="text-xs uppercase opacity-70">Days</div>
        <div id="days" class="text-4xl font-bold mt-2 digit-wrap"><span class="rotate-digit">0</span></div>
      </div>
      <div class="count-card p-4 rounded-xl text-center text-white">
        <div class="text-xs uppercase opacity-70">Hours</div>
        <div id="hours" class="text-4xl font-bold mt-2 digit-wrap"><span class="rotate-digit">0</span></div>
      </div>
      <div class="count-card p-4 rounded-xl text-center text-white">
        <div class="text-xs uppercase opacity-70">Minutes</div>
        <div id="minutes" class="text-4xl font-bold mt-2 digit-wrap"><span class="rotate-digit">0</span></div>
      </div>
      <div class="count-card p-4 rounded-xl text-center text-white">
        <div class="text-xs uppercase opacity-70">Seconds</div>
        <div id="seconds" class="text-4xl font-bold mt-2 digit-wrap"><span class="rotate-digit">0</span></div>
      </div>
    </div>
  </section>

  <!-- PARTY (appears when countdown ends) -->
  <section id="partySection" class="hidden rounded-2xl p-6 text-center">
    <div class="text-5xl">ðŸŽ‰</div>
    <h3 class="text-2xl font-semibold mt-2">Time to celebrate</h3>
    <p class="text-sm text-gray-400">The moment has arrived â€” let's party!</p>
    <div class="mt-6">
      <button id="letsCelebrateBtn" class="px-6 py-3 rounded-full bg-gradient-to-r from-pink-500 to-rose-500 text-white font-semibold shadow-lg">Let's celebrate</button>
    </div>
  </section>

  <!-- CAKE (opens when user presses Let's celebrate) -->
  <section id="cakeSection" class="hidden rounded-2xl px-6 text-center relative overflow-visible">
    <h3 id="cakeTitle" class="text-3xl font-bold">Happy birthday, Queen of my Heart ðŸ’–</h3>
    <p class="text-sm text-gray-400">It's your special day</p>

    <div class="mt-8 flex justify-center">
      <div class="cake-plate">
        <div class="cake-wrapper">
          <div class="cake" aria-hidden="true">
            <!-- bottom layer -->
            <div class="layer bottom absolute top-40 z-10">
              <div class="icing">
                <div class="drip-blob drip-1"></div>
                <div class="drip-blob drip-2"></div>
                <div class="drip-blob drip-3"></div>
                <div class="drip-blob drip-4"></div>
              </div>
              <!-- sprinkles -->
              <div class="sprinkle" style="left:8%; top:58px; background:#ff6b9a; transform: rotate(16deg);"></div>
              <div class="sprinkle" style="left:22%; top:72px; background:#ffd27a; transform: rotate(-18deg);"></div>
              <div class="sprinkle" style="left:40%; top:66px; background:#6fa7ff; transform: rotate(34deg);"></div>
            </div>

            <!-- middle layer -->
            <div class="layer mid absolute top-23 z-8" style="top: 120px;">
              <div class="icing">
                <div class="drip-blob drip-1"></div>
                <div class="drip-blob drip-3"></div>
              </div>
              <div class="sprinkle" style="left:18%; top:18px; background:#b58bff; transform: rotate(10deg);"></div>
              <div class="sprinkle" style="left:58%; top:28px; background:#ff9b4d; transform: rotate(-10deg);"></div>
            </div>

            <!-- top layer -->
            <!-- <div class="layer top absolute z-10" style="top: 200px;">
              <div class="icing">
                <div class="drip-blob drip-2"></div>
                <div class="drip-blob drip-4"></div>
              </div>
              <div class="sprinkle" style="left:30%; top:6px; background:#ffd27a; transform: rotate(6deg);"></div>
              <div class="sprinkle" style="left:62%; top:12px; background:#ff6b9a; transform: rotate(-8deg);"></div>
            </div> -->

            <!-- candles group -->
            <div class="candles absolute" style="top: -6px;" aria-hidden="true">
              <div class="candle"><div class="wick"></div><div class="flame" style="animation-duration: 0.92s;"></div></div>
              <div class="candle"><div class="wick"></div><div class="flame" style="animation-duration: 1.05s;"></div></div>
              <div class="candle"><div class="wick"></div><div class="flame" style="animation-duration: 0.86s;"></div></div>
            </div>

            <div class="cake-shadow"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- <div id="balloonsContainer" class="pointer-events-none absolute inset-0 overflow-hidden"></div> -->

    <div class="absolute top-[420px] left-20">
      <button id="continueMagicBtn" class="px-6 py-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 text-white font-semibold shadow-lg">Continue to magic</button>
    </div>
  </section>

  <!-- MAGIC CARDS -->
  <section id="magicSection" class="hidden rounded-2xl p-6 text-center">
    <h3 class="text-2xl font-semibold">Tap to open your first message</h3>
    <div class="mt-6 flex justify-center">
      <div id="bigCard" class="big-card bg-gradient-to-r from-slate-800 to-slate-700 p-6 rounded-2xl text-left text-white flex flex-col justify-between cursor-pointer max-w-[460px] w-full">
        <div><div class="text-sm opacity-70">Tap here</div><div class="text-xl font-bold mt-2">Everyone has a story.</div></div>
        <div class="text-xs opacity-60">Mine is beautiful with your existance!</div>
      </div>
    </div>

    <div id="smallCards" class="relative mt-6 h-56 flex items-end justify-center pointer-events-none"></div>

    <div class="mt-6">
      <button id="memoriesBtn" disabled class="opacity-60 px-6 py-3 rounded-full bg-gradient-to-r from-emerald-400 to-teal-500 text-white font-semibold shadow-lg">Memories</button>
    </div>
  </section>

  <!-- MEMORIES -->
  <section id="memoriesSection" class="hidden rounded-2xl p-6 text-center">
    <h3 class="text-2xl font-semibold">Memories</h3>
    <div class="mt-6 relative">
      <div id="slider" class="w-full h-[100%] overflow-hidden rounded-xl">
        <div id="slides" class="flex transition-transform duration-700"></div>
      </div>
    </div>

    <div class="mt-6">
      <button id="oneLastThing" class="px-6 py-3 rounded-full bg-gradient-to-r from-yellow-400 to-orange-400 text-white font-semibold shadow-lg">One last thing</button>
    </div>
  </section>

  <!-- LETTER -->
  <section id="letterSection" class="hidden rounded-2xl p-6 text-center">
    <h3 class="text-2xl font-semibold">A Special letter</h3>
    <div class="mt-6 bg-gray-900 p-4 rounded-lg text-left max-w-prose mx-auto shadow-sm">
      <p id="letterText" class="text-gray-200 text-base typing-cursor whitespace-pre-wrap"></p>
    </div>
  </section>

</main>

<!-- canvas-confetti CDN -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script>
/* =================== CONFIG =================== */
const INTRO_DURATION = 5000;        // ms
const COUNTDOWN_SECONDS = 10;       // demo; change to real time as needed
const MEMORIES_AUTOPLAY = 2000;     // 2s per slide


const images = [
  'two.jpg',
  'one.jpg',
  'IMG-20251030-WA0025.jpg',
  'three.jpg'
];

const cardMessages = [
  'ðŸŒ¸ Every one has a wish, Mine is to be with you till the end!',
  'ðŸŽ‚ Everyone has a good luck charm, Mine is your presence!',
  'ðŸ’– Everyone has a soft corner for someone, Mine is only for you!',
  'âœ¨ Everyone has someone special, And for me, that person is only you'
];

/* =================== HELPERS =================== */
const $ = s => document.querySelector(s);
const $$ = s => document.querySelectorAll(s);
const rand = (a,b) => Math.random()*(b-a)+a;

/* =================== INTRO DOTS -> HEART =================== */
const overlay = $('#overlay'), heartSvg = $('#heartSvg'), overlayText = $('#overlayText');
let introDots = [];

function createIntroDots(){
  introDots.forEach(d=>d.remove()); introDots=[];
  const positions = [
    {x:-80, y:40},
    {x: window.innerWidth + 80, y: window.innerHeight*0.82},
    {x: window.innerWidth*0.18, y: window.innerHeight + 100}
  ];
  const colors = ['linear-gradient(180deg,#ff8db1,#ff5572)','linear-gradient(180deg,#ffd27a,#ff9b4d)','linear-gradient(180deg,#9bd1ff,#6fa7ff)'];
  for(let i=0;i<3;i++){
    const d = document.createElement('div');
    d.className = 'intro-dot';
    d.style.left = (positions[i].x + rand(-30,30)) + 'px';
    d.style.top  = (positions[i].y + rand(-40,40)) + 'px';
    d.style.background = colors[i];
    document.body.appendChild(d);
    introDots.push(d);
  }
}

function animateDotsToCenter(){
  const rect = $('#heartWrap').getBoundingClientRect();
  const cx = rect.left + rect.width/2;
  const cy = rect.top + rect.height/2;
  introDots.forEach((d,i) => {
    const sx = parseFloat(d.style.left), sy = parseFloat(d.style.top);
    const dur = 800 + i*120;
    const start = performance.now();
    function frame(t){
      const p = Math.min(1,(t-start)/dur);
      const ease = 1 - Math.pow(1-p,3);
      const nx = sx + (cx - sx)*ease;
      const ny = sy + (cy - sy)*ease;
      d.style.left = nx + 'px';
      d.style.top  = ny + 'px';
      d.style.transform = `translate(-50%,-50%) scale(${1 - 0.45*ease})`;
      if(performance.now() - start < dur) requestAnimationFrame(frame);
      else { d.style.transition='opacity .25s'; d.style.opacity='0'; setTimeout(()=>d.remove(),300); }
    }
    requestAnimationFrame(frame);
  });
  setTimeout(()=>{ heartSvg.classList.add('show'); overlayText.style.opacity='1'; overlayText.style.transform='translateY(0)'; }, 650);
}

/* =================== CONFETTI (continuous + bursts) =================== */
let confettiIntervals = [];
function clearConfettiIntervals(){ confettiIntervals.forEach(i=>clearInterval(i)); confettiIntervals = []; }

function startContinuousConfetti(){
  clearConfettiIntervals();
  if(window.confetti){
    // gentle background
    confettiIntervals.push(setInterval(()=> {
      confetti({
        particleCount: 10,
        spread: 50,
        startVelocity: rand(10,30),
        origin: { x: rand(0,1), y: 0.02 + Math.random()*0.06 },
        gravity: 0.5,
        scalar: rand(0.7,1.1),
        colors: ['#ff6b9a','#ffd27a','#6fa7ff','#b58bff','#8ef6b8']
      });
    }, 900));
  } else {
    // fallback simple DOM confetti
    confettiIntervals.push(setInterval(()=> {
      for(let i=0;i<12;i++){
        const c = document.createElement('div');
        c.style.position='fixed'; c.style.left=(Math.random()*100)+'%'; c.style.top='-6%';
        c.style.width=(8+Math.random()*10)+'px'; c.style.height=(8+Math.random()*12)+'px';
        c.style.background=['#ff6b9a','#ffd27a','#6fa7ff','#b58bff','#8ef6b8'][Math.floor(Math.random()*5)];
        c.style.opacity='0.95'; c.style.borderRadius=Math.random()>0.6?'2px':'50%'; c.style.zIndex=9999; c.style.pointerEvents='none';
        document.body.appendChild(c);
        setTimeout(()=> c.style.transform = `translateY(110vh) rotate(${Math.random()*720}deg)`, 30);
        setTimeout(()=> c.remove(), 4200);
      }
    }, 1200));
  }
}

function bigBurst(amount=220){
  if(window.confetti){
    confetti({
      particleCount: amount,
      spread: 140,
      startVelocity: 60,
      origin: { x: Math.random(), y: Math.random()*0.12 },
      ticks: 200,
      gravity: 0.6,
      colors: ['#ff6b9a','#ffd27a','#6fa7ff','#b58bff','#8ef6b8'],
      scalar: 1.6
    });
  } else {
    for(let i=0;i<150;i++){
      const c = document.createElement('div');
      c.style.position='fixed'; c.style.left=(Math.random()*100)+'%'; c.style.top='-6%';
      c.style.width=(10+Math.random()*18)+'px'; c.style.height=(10+Math.random()*18)+'px';
      c.style.background=['#ff6b9a','#ffd27a','#6fa7ff','#b58bff','#8ef6b8'][Math.floor(Math.random()*5)];
      c.style.opacity='0.98'; c.style.borderRadius=Math.random()>0.5?'2px':'50%'; c.style.zIndex=9999; c.style.pointerEvents='none';
      document.body.appendChild(c);
      setTimeout(()=> c.style.transform=`translateY(${110 + Math.random()*40}vh) rotate(${Math.random()*720}deg)`,30);
      setTimeout(()=> c.remove(),4200);
    }
  }
}

/* =================== BALLOONS (realistic & 2s timer) =================== */
const balloonsContainer = $('#balloonsContainer');
let balloonInterval = null;
let balloonRunning = false;

function spawnBalloonOnce(opts = {}) {
  const b = document.createElement('div'); b.className='balloon';
  // size variation
  const w = opts.width || Math.round(rand(40,72));
  const h = Math.round(w * (1.2 + Math.random()*0.25));
  b.style.width = w + 'px'; b.style.height = h + 'px';
  // color gradient
  const hue = opts.hue || Math.floor(rand(0,360));
  b.style.background = `linear-gradient(180deg, hsl(${hue} 85% 70%), hsl(${(hue+18)%360} 75% 50%))`;
  // left position within cake area (use vw but keep inside)
  const left = Math.round(rand(12,88));
  b.style.left = left + 'vw';
  b.style.zIndex = 55;
  // add shine and string
  const shine = document.createElement('div'); shine.className='shine'; b.appendChild(shine);
  const string = document.createElement('div'); string.className='string'; b.appendChild(string);
  // animation duration random
  const dur = Math.floor(rand(4200,9200));
  b.style.animation = `balloonRise ${dur}ms linear forwards`;
  // horizontal sway via Web Animations API
  b.animate([{ transform:'translateX(0)' }, { transform:`translateX(${rand(-36,36)}px)` }, { transform:'translateX(0)' }], { duration: rand(1600,3400), iterations: Infinity, direction:'alternate' });
  balloonsContainer.appendChild(b);
  // remove once offscreen
  setTimeout(()=> { try { b.remove(); } catch(e){} }, dur + 350);
  return b;
}

function startBalloonsBurst(count = 6) {
  // start only once
  if(balloonRunning) return;
  balloonRunning = true;
  // initial small burst spaced slightly
  for(let i=0;i<count;i++){
    setTimeout(()=> spawnBalloonOnce(), i*180 + Math.random()*220);
  }
  // then repeat every 2s
  if(balloonInterval) clearInterval(balloonInterval);
  balloonInterval = setInterval(()=> {
    // 1â€“3 balloons every tick
    const n = Math.random() > 0.7 ? 2 : 1;
    for(let i=0;i<n;i++) spawnBalloonOnce();
  }, 2000);
}

function stopBalloons(){
  if(balloonInterval){ clearInterval(balloonInterval); balloonInterval = null; }
  balloonRunning = false;
}

/* =================== COUNTDOWN logic =================== */
const daysEl = $('#days'), hoursEl = $('#hours'), minutesEl = $('#minutes'), secondsEl = $('#seconds');
let countdownInterval, targetDate = new Date(Date.now() + COUNTDOWN_SECONDS*1000);

function setDigit(el, value){
  const span = el.querySelector('.rotate-digit');
  if(span){
    span.textContent = value;
    span.classList.remove('digit-anim');
    void span.offsetWidth;
    span.classList.add('digit-anim');
  } else el.textContent = value;
}

function startCountdown(){
  updateCountdown();
  countdownInterval = setInterval(updateCountdown, 250);
}
function updateCountdown(){
  const now = new Date(); const diff = Math.max(0, targetDate - now);
  if(diff <= 0){
    clearInterval(countdownInterval);
    setDigit(daysEl,0); setDigit(hoursEl,0); setDigit(minutesEl,0); setDigit(secondsEl,0);
    // reveal party section with big burst (user still must click to open cake)
    showSection('partySection');
    bigBurst(260);
    // continuous confetti already running
    return;
  }
  const total = Math.floor(diff/1000);
  const s = total % 60;
  const m = Math.floor(total/60) % 60;
  const h = Math.floor(total/3600) % 24;
  const d = Math.floor(total/3600/24);
  setDigit(daysEl,d); setDigit(hoursEl,h); setDigit(minutesEl,m); setDigit(secondsEl,s);
}

/* =================== SECTION helpers =================== */
function hideAllSections(){ document.querySelectorAll('main > section').forEach(s=> s.classList.add('hidden')); }
function showSection(id){
  hideAllSections();
  const el = document.getElementById(id); if(!el) return;
  el.classList.remove('hidden');
  el.style.opacity = 0; el.style.transform = 'translateY(8px)';
  setTimeout(()=> { el.style.transition = 'opacity .45s ease, transform .45s ease'; el.style.opacity = 1; el.style.transform = 'translateY(0)'; }, 10);
  // show dramatic burst on major section reveals
  if(id !== 'countdownSection') bigBurst(120);
  window.scrollTo({ top:0, behavior: 'smooth' });
}

/* =================== MAGIC CARDS =================== */
const bigCard = $('#bigCard'), smallCards = $('#smallCards'), memoriesBtn = $('#memoriesBtn');
let spawnCount = 0, maxSpawn = Math.min(4, cardMessages.length);
function clearPrevBlurs(){
  const nodes = smallCards.querySelectorAll('.small-card');
  nodes.forEach((n,i)=>{ n.classList.remove('prev-blur'); if(i < nodes.length-1) n.classList.add('prev-blur'); else n.classList.remove('prev-blur'); });
}
bigCard.addEventListener('click', ()=>{
  if(spawnCount >= maxSpawn) return;
  const msg = cardMessages[spawnCount] || `Surprise ${spawnCount+1}`; spawnCount++;
  const card = document.createElement('div');
  card.className = 'small-card bg-gradient-to-r from-pink-500 to-rose-400 text-white p-4 absolute flex flex-col justify-center items-center text-center';
  card.style.left = '50%'; card.style.transform = 'translateX(-50%) translateY(40px) scale(.96)';
  card.style.zIndex = 100 + spawnCount;
  let offsetBase = (spawnCount - 1) * 110 - 110;
  const scale = window.innerWidth < 640 ? 0.34 : 1;
  const offsetX = Math.round(offsetBase * scale);
  card.dataset.offsetX = offsetX;
  card.innerHTML = `<div class="text-lg font-semibold">${msg}</div>`;
  smallCards.appendChild(card);
  setTimeout(()=> {
    card.style.transition = 'transform .55s cubic-bezier(.2,.9,.2,1), opacity .45s, left .55s';
    card.style.left = `calc(40% + ${offsetX}px)`;
    card.style.transform = 'translateX(-50%) translateY(-130px) scale(1)';
    card.classList.add('show');
    clearPrevBlurs();
    bigBurst(160);
  }, 50);
  const nodes = smallCards.querySelectorAll('.small-card'); nodes.forEach(n=>{ if(n !== card) n.classList.add('prev-blur'); });
  if(spawnCount >= maxSpawn){
    setTimeout(()=> {
      memoriesBtn.disabled = false; memoriesBtn.classList.remove('opacity-60'); memoriesBtn.classList.add('scale-[1.03]');
      memoriesBtn.style.transition = 'transform .4s ease, opacity .4s ease';
      setTimeout(()=> memoriesBtn.classList.remove('scale-[1.03]'), 300);
    }, 450);
  }
});

/* =================== SLIDER (2s autoplay) =================== */
const slidesEl = $('#slides'); let currentSlide = 0, slideInterval;
function populateSlides(){
  slidesEl.innerHTML = '';
  images.forEach((src,i)=>{
    const s = document.createElement('div'); s.className='slide flex-shrink-0 rounded-xl';
    s.style.backgroundImage = `url(${src})`; s.style.backgroundSize='cover';
    const inner = document.createElement('div'); inner.className='w-full h-full flex items-end p-4';
    inner.innerHTML = `<div class="bg-black/40 p-3 rounded-md backdrop-blur-sm max-w-xl text-left"> <div class="text-lg font-semibold text-white">Memorable Moments</div> <div class="text-sm text-gray-200 mt-1">moments i never forget Aminah ðŸ’–.</div></div>`;
    s.appendChild(inner); slidesEl.appendChild(s);
  });
  updateSlider(); startAutoSlide();
}
function updateSlider(){ slidesEl.style.transform = `translateX(-${currentSlide * 100}%)`; }
function startAutoSlide(){ clearInterval(slideInterval); slideInterval = setInterval(()=> {
  const prev = currentSlide; currentSlide = (currentSlide+1) % images.length;
  const nodes = slidesEl.querySelectorAll('.slide'); if(nodes[prev]) nodes[prev].classList.add('fade-out');
  setTimeout(()=> { if(nodes[prev]) nodes[prev].classList.remove('fade-out'); updateSlider(); }, 80);
}, MEMORIES_AUTOPLAY); }

/* =================== LETTER typing =================== */
function letterContent(){
  return `ðŸ’– HBD CUTEii Aminah ðŸ’– \n\n
  Happy birthday to the person I love the most You are the reson for my happiness, and I can never thank you enough for it.\n
  Or jana jab sy me ap sy mila hun mujy meri zindagi bht pyari lagny lagi h,ap mujy meri jaan sy b zyada azeez han,ap k sadky me apni puri duniya apna sab kuch waar sakta hun \n\n mera pyaar ap k ek samundar jasa ha jis ke gehrai kabhi ni samjhi ja sakti,Me ny hamysha apko Rooh sy chaha ha or Allah ke raza k liye muhabbat ke ha,AP meri ankhoo ka noor ho,mery dill ka Sakoon ho,meri Mata-e-jaan ho,mera jan-e-jahan ho,is specail day py apko bht c khushiya mubarik ho \n\nAllah pak apko kabhi ko dukh na dy ap k hisy ka her gum mujy mil jayee Allah pak apko do jahano ke khushiya naseeb kry Ameen.Some Specail words for you..\n\nWaqat apko zinda rakhy,bharain ap pr fida hon,Rehmatoo k derwaze hamysha ap pr khulaee or unhy kabhi bnd hony ka hukam na milee,her dukh her be-sakoni k sayee andhay ho jayee ap tak any ke koi rah unhye nazer na ayee Ameen, Happy Birthday MERI Kul Kainat Meri Aminah.\n\n 
  Once again, a very Happy Birthday to you ðŸŽ‚ Enjoy your day to the fullest... Love you biggieðŸ’–
  `;
}
function startTyping(text, el){
  el.textContent = ''; let i=0; const speed=26; const t=setInterval(()=> {
    if(i>=text.length){ clearInterval(t); el.classList.remove('typing-cursor'); return; }
    el.textContent += text[i++];
  }, speed);
}

/* =================== INIT flow =================== */
function init(){
  // make overlay animation
  createIntroDots(); setTimeout(()=> animateDotsToCenter(), 120);
  // after intro -> show countdown and start gentle confetti
  setTimeout(()=> {
    overlay.style.transition = 'opacity .6s ease, transform .6s ease'; overlay.style.opacity = 0; overlay.style.transform = 'scale(.98)';
    setTimeout(()=> overlay.remove(), 700);
    showSection('countdownSection');
    startCountdown();
    startContinuousConfetti();
  }, INTRO_DURATION);

  // buttons wiring
  $('#letsCelebrateBtn').addEventListener('click', ()=> {
    // When user presses Let's celebrate -> open cake section (confetti continues)
    showSection('cakeSection');
    // start balloons (after 2s inside startBalloonsBurst) and a big burst
    setTimeout(()=> { startBalloonsBurst(10); }, 2000); // extra guard: start after 2s when cake opens
    bigBurst(220);
  });
  $('#continueMagicBtn').addEventListener('click', ()=> { showSection('magicSection'); });
  $('#memoriesBtn').addEventListener('click', ()=> { if(!$('#memoriesBtn').disabled) { showSection('memoriesSection'); populateSlides(); } });
  $('#oneLastThing').addEventListener('click', ()=> { showSection('letterSection'); startTyping(letterContent(), $('#letterText')); });

  // set name on cake title
  $('#cakeTitle').textContent = `Happy birthday, Queen of my Heart â¤`;

  // set countdown card gradients
  const c = document.querySelectorAll('.count-card'); if(c && c.length>=4){
    c[0].style.background='linear-gradient(135deg,#7c3aed,#0ea5e9)';
    c[1].style.background='linear-gradient(135deg,#f97316,#fb7185)';
    c[2].style.background='linear-gradient(135deg,#34d399,#06b6d4)';
    c[3].style.background='linear-gradient(135deg,#f59e0b,#ef4444)';
  }
}

function createIntroDots(){ introDots.forEach(d=>d.remove()); introDots=[]; const positions = [{x:-80,y:40},{x: window.innerWidth + 80,y: window.innerHeight*0.82},{x: window.innerWidth*0.18,y: window.innerHeight + 100}]; const colors = ['linear-gradient(180deg,#ff8db1,#ff5572)','linear-gradient(180deg,#ffd27a,#ff9b4d)','linear-gradient(180deg,#9bd1ff,#6fa7ff)']; for(let i=0;i<3;i++){ const d=document.createElement('div'); d.className='intro-dot'; d.style.left=(positions[i].x + rand(-30,30))+'px'; d.style.top=(positions[i].y + rand(-40,40))+'px'; d.style.background=colors[i]; document.body.appendChild(d); introDots.push(d);} }

init();

/* cleanup */
window.addEventListener('beforeunload', ()=> { clearConfettiIntervals(); clearInterval(slideInterval); clearInterval(balloonInterval); });
</script>
</body>
</html>
